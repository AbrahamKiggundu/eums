<div class="container-fluid">
    <ng-include src="'/static/app/views/partials/navigation-tabs.html'"></ng-include>

    <div ng-controller="NewDistributionPlanController" ng-init="initialize()" class="content">
        <h4 class="page-header">Create A Distribution Plan</h4>

        <div class="panel panel-default line-order-panel">
            <div class="panel-title">
                <div class="panel-body">
                    <div class="form-group form-group-sm col-lg-4">
                        <select ng-model="salesOrderItemSelected" required="required"
                                class="form-control input-sm"
                                ng-options="salesOrderItem.display for salesOrderItem in salesOrderItems">
                            <option value="" selected="selected">Select Item</option>
                        </select>
                    </div>
                </div>

                <div ng-show="hasSalesOrderItems">
                    <alert ng-show="!hasItemsLeft()" type="danger">All quantities have been assigned for this item.
                    </alert>
                    <table class="table table-hover table-striped table-bordered">
                        <th>Sales Order</th>
                        <th>Material</th>
                        <th>Item Description</th>
                        <th>Quantity</th>
                        <th>Unit</th>
                        <th>Programme</th>

                        <tr>
                            <td>{{ selectedSalesOrder.order_number }}</td>
                            <td>{{ salesOrderItemSelected.material_code }}</td>
                            <td>{{ salesOrderItemSelected.display }}</td>
                            <td>{{ salesOrderItemSelected.quantity }}</td>
                            <td>{{ salesOrderItemSelected.unit }}</td>
                            <td>{{ selectedSalesOrder.programme.name }}</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <div ng-show="hasSalesOrderItems" class="panel panel-default">
            <div class="panel-body">
                <div ng-show="hasDistributionPlanItems">
                    <table id="distributionPlanTable"
                           class="table table-bordered table-striped table-hover">
                        <th class="col-lg-1">Sales Order Qty</th>
                        <th class="col-lg-1">Unit</th>
                        <th class="col-lg-1">Targeted Qty</th>
                        <th class="col-lg-1">Planned Distr Date</th>
                        <th class="col-lg-2">Programme Focal</th>
                        <th class="col-lg-2">Consignee</th>
                        <th class="col-lg-2">Contact Person</th>
                        <th class="col-lg-1">Region/District</th>
                        <th class="col-lg-1">Mode of Delivery</th>

                        <tr ng-repeat="distributionPlanItem in distributionPlanItems">
                            <td>{{ distributionPlanItem.quantity }}</td>
                            <td>{{ salesOrderItemSelected.unit }}</td>
                            <td ng-show="hasTargetedQuantity(distributionPlanItem)">
                                {{ distributionPlanItem.targeted_quantity }}
                            </td>
                            <td ng-show="hasTargetedQuantity(distributionPlanItem)">
                                {{ distributionPlanItem.planned_distribution_date }}
                            </td>
                            <td ng-show="hasTargetedQuantity(distributionPlanItem)">
                                {{ distributionPlanItem.programme_focal }}
                            </td>
                            <td ng-show="hasTargetedQuantity(distributionPlanItem)">
                                {{ distributionPlanItem.consignee }}
                            </td>
                            <td ng-show="hasTargetedQuantity(distributionPlanItem)">
                                {{ distributionPlanItem.contact_person }}
                            </td>
                            <td ng-show="hasTargetedQuantity(distributionPlanItem)">
                                {{ distributionPlanItem.destination_location }}
                            </td>
                            <td ng-show="hasTargetedQuantity(distributionPlanItem)">
                                {{ distributionPlanItem.mode_of_delivery }}
                            </td>

                            <td ng-show="!hasTargetedQuantity(distributionPlanItem)">
                                <input type="text" class="input-quantity"
                                       ng-model="distributionPlanItem.target_quantity">
                            </td>
                            <td ng-show="!hasTargetedQuantity(distributionPlanItem)">

                                <input type="date" required="required"
                                       ng-model="distributionPlanItem.planned_distribution_date">
                            </td>
                            <td ng-show="!hasTargetedQuantity(distributionPlanItem)">
                                {{ selectedSalesOrder.programme.focalPerson.firstName }}
                                {{ selectedSalesOrder.programme.focalPerson.lastName }}
                            </td>
                            <td ng-show="!hasTargetedQuantity(distributionPlanItem)">
                                <input type="hidden" search-from-list list="{{ consignees }}"
                                       ng-model="distributionPlanItem.consignee">
                            </td>

                            <td ng-show="!hasTargetedQuantity(distributionPlanItem)">
                                <input type="hidden" search-contacts
                                       ng-model="distributionPlanItem.contact_person" required="required">
                                <i class="glyphicon glyphicon-plus pull-right"></i>
                            </td>

                            <td ng-show="!hasTargetedQuantity(distributionPlanItem)">
                                <input type="hidden" search-from-list list="{{ districts }}"
                                       ng-model="distributionPlanItem.destination_location">
                            </td>
                            <td ng-show="!hasTargetedQuantity(distributionPlanItem)">
                                <input type="hidden" search-from-list
                                       list='[{"id": "DIRECT_DELIVERY", "name": "Direct Delivery"}, {"id": "WAREHOUSE", "name": "Warehouse"}]'
                                       ng-model="distributionPlanItem.mode_of_delivery">
                            </td>
                        </tr>
                    </table>
                </div>

            </div>
        </div>


        <div>
            <button ng-show="hasItemsLeft()" type="button" class="btn btn-primary"
                    ng-click="addDistributionPlanItem()"><i
                    class="glyphicon glyphicon-plus"> </i>Add IP
            </button>
            <div ng-show="hasDistributionPlanItems" style="float: right">
                <button ng-show="hasItemsLeft()" type="button" class="btn btn-primary"
                        ng-click="saveDistributionPlanItem(distributionPlanItems)"><i
                        class="glyphicon glyphicon-save"> </i>Save
                </button>
            </div>
        </div>
    </div>
</div>